# tRPC-Cpp Configuration with LRU Cached Polaris Selector
# 
# This example shows how to use the lru_polaris selector for
# automatic service discovery with built-in LRU caching.

global:
  threadmodel:
    fiber:
      - instance_name: fiber_instance
        concurrency_hint: 8

client:
  service:
    # ============================================
    # Example 1: Direct connection (no caching needed)
    # ============================================
    - name: trpc.internal.DebugService
      target: 127.0.0.1:9999
      protocol: trpc
      network: tcp
      selector_name: direct  # No caching, direct connection
    
    # ============================================
    # Example 2: Using Polaris WITHOUT cache
    # ============================================
    - name: trpc.user.UserService
      target: UserService      # Service name in Polaris
      protocol: trpc
      network: tcp
      selector_name: polaris   # Query Polaris every time (100ms overhead)
    
    # ============================================
    # Example 3: Using Polaris WITH LRU cache (Recommended!)
    # ============================================
    - name: trpc.order.OrderService
      target: OrderService     # Service name in Polaris
      protocol: trpc
      network: tcp
      selector_name: lru_polaris  # âœ… Use cached Polaris selector!
                                   # - First call: query Polaris (100ms)
                                   # - Subsequent calls: from cache (0.01ms)
                                   # - TTL: 60 seconds (auto refresh)
    
    # ============================================
    # Example 4: Another service with cached Polaris
    # ============================================
    - name: trpc.product.ProductService
      target: ProductService
      protocol: trpc
      network: tcp
      selector_name: lru_polaris  # Same selector, different service
    
    # ============================================
    # Example 5: Payment service with LRU cache
    # ============================================
    - name: trpc.payment.PaymentService
      target: PaymentService
      protocol: trpc
      network: tcp
      selector_name: lru_polaris

plugins:
  log:
    default:
      - name: default
        sinks:
          local_file:
            filename: trpc_client.log
            
  # Polaris plugin configuration (required for lru_polaris to work)
  naming:
    polaris:
      - name: polaris_naming
        # Add your Polaris configuration here
        # ...

# Performance Benefits of lru_polaris:
# 
# Without cache (selector_name: polaris):
#   - Every RPC call queries Polaris: 100ms overhead
#   - 1000 calls = 100,000ms (100 seconds) on service discovery
#   - High load on Polaris server
# 
# With cache (selector_name: lru_polaris):
#   - First call queries Polaris: 100ms
#   - Next 999 calls from cache: 0.01ms each
#   - 1000 calls = 100ms + 10ms = 110ms total
#   - 900x faster! 
#   - 80% reduction in Polaris load
